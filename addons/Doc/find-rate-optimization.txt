

RATE : norway mobile netcom  	474890
NUMBER CALL : 474890111111


=====================================================================
	Original Find rates
=====================================================================

- QUERY -
---------

SELECT 
	tariffgroupname, lcrtype, idtariffgroup, cc_tariffgroup_plan.idtariffplan, tariffname, destination,
	cc_ratecard.id, dialprefix, destination, buyrate, buyrateinitblock, buyrateincrement, rateinitial, initblock, billingblock, 
	connectcharge, disconnectcharge, stepchargea, chargea, timechargea, billingblocka, stepchargeb, chargeb, 
	timechargeb, billingblockb, stepchargec, chargec, timechargec, billingblockc,
	cc_tariffplan.id_trunk AS tp_id_trunk, tp_trunk.trunkprefix AS tp_trunk, tp_trunk.providertech AS tp_providertech, 
	tp_trunk.providerip AS tp_providerip, tp_trunk.removeprefix AS tp_removeprefix,
	cc_ratecard.id_trunk AS rc_id_trunk, rt_trunk.trunkprefix AS rc_trunkprefix, rt_trunk.providertech AS rc_providertech, 
	rt_trunk.providerip AS rc_providerip, rt_trunk.removeprefix AS rc_removeprefix,
	musiconhold,
	tp_trunk.failover_trunk AS tp_failover_trunk,
	rt_trunk.failover_trunk AS rt_failover_trunk,
	tp_trunk.addparameter AS tp_addparameter_trunk,
	rt_trunk.addparameter AS rt_addparameter_trunk,
	id_outbound_cidgroup,
	freetimetocall_package_offer, freetimetocall, packagetype, billingtype, startday, id_cc_package_offer,
	tp_trunk.status, rt_trunk.status, tp_trunk.inuse, rt_trunk.inuse, tp_trunk.maxuse, rt_trunk.maxuse, tp_trunk.if_max_use, 
	rt_trunk.if_max_use, cc_ratecard.rounding_calltime AS rounding_calltime,
	cc_ratecard.rounding_threshold AS rounding_threshold, cc_ratecard.additional_block_charge AS additional_block_charge,
	cc_ratecard.additional_block_charge_time AS additional_block_charge_time

FROM 
	cc_tariffgroup 
	RIGHT JOIN cc_tariffgroup_plan ON cc_tariffgroup.id=3
	INNER JOIN cc_tariffplan ON (cc_tariffplan.id=cc_tariffgroup_plan.idtariffplan )

	LEFT JOIN cc_ratecard ON cc_ratecard.idtariffplan=cc_tariffplan.id
	LEFT JOIN cc_trunk AS rt_trunk ON cc_ratecard.id_trunk=rt_trunk.id_trunk
	LEFT JOIN cc_trunk AS tp_trunk ON cc_tariffplan.id_trunk=tp_trunk.id_trunk
	LEFT JOIN cc_package_offer ON cc_package_offer.id=cc_tariffgroup.id_cc_package_offer

WHERE
	(dialprefix=SUBSTRING('474890111111',1,length(dialprefix)) OR dialprefix='defaultprefix')
	AND idtariffgroup='3'

ORDER BY 
	LENGTH(dialprefix) DESC


---------------------------------------

Profiling
Status 	Time
(initialization) 	0.000002
checking query cache for query 	0.000202
Opening tables 	0.000021
System lock 	0.000008
Table lock 	0.000069
init 	0.00016
optimizing 	0.000023
statistics 	0.000073
preparing 	0.000034
Creating tmp table 	0.000067
executing 	0.000004
Copying to tmp table 	0.010605
Sorting result 	0.000018
Sending data 	0.000136
end 	0.000004
removing tmp table 	0.000012
end 	0.000005
query end 	0.000003
storing result in query cache 	0.000003
freeing items 	0.000018
closing tables 	0.000007
logging slow query 	0.000003

Showing rows 0 - 3 (4 total, Query took 0.0116 sec)






=====================================================================
	AFTER CHANGE TO OPTIMIZE find rates
=====================================================================


SELECT 
	tariffgroupname, lcrtype, idtariffgroup, cc_tariffgroup_plan.idtariffplan, tariffname, destination,
	cc_ratecard.id, dialprefix, destination, buyrate, buyrateinitblock, buyrateincrement, rateinitial, initblock, billingblock, 
	connectcharge, disconnectcharge, stepchargea, chargea, timechargea, billingblocka, stepchargeb, chargeb, 
	timechargeb, billingblockb, stepchargec, chargec, timechargec, billingblockc,
	cc_tariffplan.id_trunk AS tp_id_trunk, tp_trunk.trunkprefix AS tp_trunk, tp_trunk.providertech AS tp_providertech, 
	tp_trunk.providerip AS tp_providerip, tp_trunk.removeprefix AS tp_removeprefix,
	cc_ratecard.id_trunk AS rc_id_trunk, rt_trunk.trunkprefix AS rc_trunkprefix, rt_trunk.providertech AS rc_providertech, 
	rt_trunk.providerip AS rc_providerip, rt_trunk.removeprefix AS rc_removeprefix,
	musiconhold,
	tp_trunk.failover_trunk AS tp_failover_trunk,
	rt_trunk.failover_trunk AS rt_failover_trunk,
	tp_trunk.addparameter AS tp_addparameter_trunk,
	rt_trunk.addparameter AS rt_addparameter_trunk,
	id_outbound_cidgroup,
	freetimetocall_package_offer, freetimetocall, packagetype, billingtype, startday, id_cc_package_offer,
	tp_trunk.status, rt_trunk.status, tp_trunk.inuse, rt_trunk.inuse, tp_trunk.maxuse, rt_trunk.maxuse, tp_trunk.if_max_use, 
	rt_trunk.if_max_use, cc_ratecard.rounding_calltime AS rounding_calltime,
	cc_ratecard.rounding_threshold AS rounding_threshold, cc_ratecard.additional_block_charge AS additional_block_charge,
	cc_ratecard.additional_block_charge_time AS additional_block_charge_time

FROM 
	cc_tariffgroup 
	RIGHT JOIN cc_tariffgroup_plan ON cc_tariffgroup.id=3
	INNER JOIN cc_tariffplan ON (cc_tariffplan.id=cc_tariffgroup_plan.idtariffplan )

	LEFT JOIN cc_ratecard ON cc_ratecard.idtariffplan=cc_tariffplan.id
	LEFT JOIN cc_trunk AS rt_trunk ON cc_ratecard.id_trunk=rt_trunk.id_trunk
	LEFT JOIN cc_trunk AS tp_trunk ON cc_tariffplan.id_trunk=tp_trunk.id_trunk
	LEFT JOIN cc_package_offer ON cc_package_offer.id=cc_tariffgroup.id_cc_package_offer

WHERE
	(dialprefix ='4' OR dialprefix ='47' OR dialprefix ='474' OR dialprefix ='4748' OR dialprefix ='47489' OR dialprefix ='474890' OR dialprefix ='4748901' OR dialprefix ='47489011' OR dialprefix ='474890111' OR dialprefix ='4748901111' OR dialprefix ='47489011111' OR dialprefix='defaultprefix')
	AND idtariffgroup='3'

ORDER BY 
	LENGTH(dialprefix) DESC

	

Profiling
--------------------
Status 	Time
(initialization) 	0.000003
checking query cache for query 	0.000219
Opening tables 	0.000024
System lock 	0.000009
Table lock 	0.000083
init 	0.000189
optimizing 	0.000029
statistics 	0.000451
preparing 	0.000031
Creating tmp table 	0.0000660
executing 	0.000003
Copying to tmp table 	0.000172
Sorting result 	0.000013
Sending data 	0.000105
end 	0.000002
removing tmp table 	0.000007
end 	0.000003
query end 	0.000003
storing result in query cache 	0.000003
freeing items 	0.000012
closing tables 	0.000006
logging slow query 	0.000003

Showing rows 0 - 3 (4 total, Query took 0.0016 sec)

